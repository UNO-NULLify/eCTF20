<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Technical Reference | eCTF Documentation</title>
    <meta name="description" content="NULLify">
    
    
    <link rel="preload" href="/assets/css/0.styles.b01e252a.css" as="style"><link rel="preload" href="/assets/js/app.460b592d.js" as="script"><link rel="preload" href="/assets/js/2.cccabd22.js" as="script"><link rel="preload" href="/assets/js/11.c2b48b7a.js" as="script"><link rel="prefetch" href="/assets/js/10.7a489bff.js"><link rel="prefetch" href="/assets/js/12.7d49c0c3.js"><link rel="prefetch" href="/assets/js/13.c41ebb83.js"><link rel="prefetch" href="/assets/js/14.061be732.js"><link rel="prefetch" href="/assets/js/15.5700970b.js"><link rel="prefetch" href="/assets/js/16.f0bdaa89.js"><link rel="prefetch" href="/assets/js/17.59941c79.js"><link rel="prefetch" href="/assets/js/18.046e4061.js"><link rel="prefetch" href="/assets/js/19.b6461339.js"><link rel="prefetch" href="/assets/js/3.a99c79da.js"><link rel="prefetch" href="/assets/js/4.785400c9.js"><link rel="prefetch" href="/assets/js/5.fc3963fa.js"><link rel="prefetch" href="/assets/js/6.51f8d839.js"><link rel="prefetch" href="/assets/js/7.e4ecca8e.js"><link rel="prefetch" href="/assets/js/8.1a99a3d0.js"><link rel="prefetch" href="/assets/js/9.1c65a45d.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b01e252a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/nullify_lock_no_padding.png" alt="eCTF Documentation" class="logo"> <span class="site-name can-hide">eCTF Documentation</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/user/" class="nav-link">User Guide</a></div><div class="nav-item"><a href="/technical/" class="nav-link router-link-exact-active router-link-active">Technical Reference</a></div><div class="nav-item"><a href="/internal/" class="nav-link">Internal</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/user/" class="nav-link">User Guide</a></div><div class="nav-item"><a href="/technical/" class="nav-link router-link-exact-active router-link-active">Technical Reference</a></div><div class="nav-item"><a href="/internal/" class="nav-link">Internal</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/" class="sidebar-link">Home</a></li><li><a href="/user/" class="sidebar-link">User Guide</a></li><li><section class="sidebar-group depth-0"><a href="/technical/" class="sidebar-heading clickable router-link-exact-active router-link-active active"><span>Technical Reference</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/technical/hardware.html" class="sidebar-link">Hardware</a></li><li><a href="/technical/software.html" class="sidebar-link">Software</a></li><li><a href="/technical/compiler-fixes.html" class="sidebar-link">Compiler Upgrades</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/internal/" class="sidebar-heading clickable"><span>Internal Documentation</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/internal/initial-plans.html" class="sidebar-link">Initial Plans</a></li><li><a href="/internal/code-reviews.html" class="sidebar-link">Code Reviews</a></li><li><a href="/internal/attack.html" class="sidebar-link">Attack</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="technical-reference"><a href="#technical-reference" class="header-anchor">#</a> Technical Reference</h1> <p>Below is the overview of how to set up the reference implementation for the 2020 Collegiate eCTF.</p> <p>Please note: if any step fails, it is highly unlikely that the process will get back on track by continuing to future steps.</p> <h2 id="creating-your-own-fork"><a href="#creating-your-own-fork" class="header-anchor">#</a> Creating Your Own Fork</h2> <p>We suggest you create a fork of this repo so that you can begin to develop
your solution to the eCTF. To do this, you must fork the repo, change your fork to the <code>origin</code>, and
then add the MITRE repo as another remote. Follow these steps below.</p> <ol><li>Clone the eCTF repository using ssh or https</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">git</span> clone https://github.com/mitre-cyber-academy/2020-ectf-insecure-example --recursive
</code></pre></div><ol start="2"><li>Change the current origin remote to another name</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">git</span> remote <span class="token function">rename</span> origin mitre
</code></pre></div><ol start="3"><li><p>Fork the MITRE repo on github (Note that you probably want to make the repo private for now so
that other teams cannot borrow your development ideas)</p></li> <li><p>Add the fork as the new origin</p></li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">git</span> remote <span class="token function">add</span> origin <span class="token operator">&lt;</span>git_path<span class="token operator">&gt;</span>.git
</code></pre></div><p>You can now fetch and push as you normally would using <code>git fetch origin</code> and <code>git push origin</code>.
If we push out updated code, you can fetch this new code using <code>git fetch mitre</code>.</p> <h2 id="download-xilinx-tools"><a href="#download-xilinx-tools" class="header-anchor">#</a> Download Xilinx Tools</h2> <p>We require using the two main Xilinx tools for the development of your
design: Vivado and the Xilinx Software Development Kit (SDK). Vivado is used to create the
Programmable Logic design. For the reference design, this includes the Xilinx MicroBlaze, a soft
microprocessor core. Applications for the MicroBlaze can be written using the Xilinx SDK. More
information about these tools will be discussed when building the reference design.</p> <ol><li><a href="https://www.xilinx.com/support/download/index.html/content/xilinx/en/downloadNav/vivado-design-tools/archive.html" target="_blank" rel="noopener noreferrer">Go to the Xilinx website<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>Download the 2017.4 version -&gt; All OS Installer Single-File Download</li> <li>Login or create a Xilinx account. Note: you can use your college email and location as your &quot;corporation&quot;</li> <li>Place the downloaded zip file into the root directory of your project - Vagrant will install it on the VM</li></ol> <h2 id="vagrant"><a href="#vagrant" class="header-anchor">#</a> Vagrant</h2> <p>In order to manage dependencies and allow for easier cross-platform development, a VM provisioned by
<a href="https://vagrantup.com" target="_blank" rel="noopener noreferrer">Vagrant<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> will be used for building and provisioning the design. Please see
the <a href="/technical/vagrant/">Vagrant README</a> file for information about setting up the Vagrant environment before
proceeding. Setting up the vagrant machine will take at least 1 hour and should be completed in one sitting
to avoid common errors that occur when pausing and resuming the setup process.
Please allocate enough time for this process and be sure the follow the steps in the <code>README</code>
carefully.</p> <h2 id="building-the-reference-design"><a href="#building-the-reference-design" class="header-anchor">#</a> Building the Reference Design</h2> <p>This section assumes that you have a Vagrant development
environment running as described in the <code>vagrant</code> folder, and that you have read through all of the
<code>README</code> files in each subdirectory.</p> <p>To build the reference design for the first time, follow these steps:</p> <ol><li>Ensure that all steps to provision the development environment were completed as described
in the <a href="/technical/vagrant/">Vagrant README</a> file.</li> <li>Log in to the virtual machine using the credentials <code>vagrant:vagrant</code>.</li> <li>Open a terminal and <code>cd</code> to the <code>tools</code> directory.</li> <li>Run <code>mkdir global_provisioning/audio -p</code> to make a directory called <code>global_provisioning</code>, with a subfolder of <code>audio</code> for audio files.</li> <li>Run <code>./createRegions --region-list &quot;United States&quot; &quot;Japan&quot; &quot;Australia&quot; --outfile global_provisioning/region.secrets</code> script to create the geographical regions (USA, Japan, and Australia in this case)</li> <li>Run <code>./createUsers --user-list &quot;drew:1234567890&quot; &quot;ben:00000000&quot; &quot;misha:0987654321&quot; --outfile global_provisioning/user.secrets</code> script to create the 3 users (&quot;drew&quot;, &quot;ben&quot; and &quot;misha&quot;) with their pins.</li> <li>Run <code>./protectSong --region-list &quot;United States&quot; --region-secrets-path global_provisioning/region.secrets --outfile global_provisioning/audio/demo.drm --infile ../sample-audio/Sound-Bite_One-Small-Step.wav --owner &quot;drew&quot; --user-secrets-path global_provisioning/user.secrets</code> to provision a song for the United States region, with &quot;drew&quot; as an owner.</li> <li>Run <code>./createDevice --region-list &quot;United States&quot; &quot;Japan&quot; --region-secrets-path global_provisioning/region.secrets --user-list &quot;drew&quot; &quot;ben&quot; &quot;misha&quot; --user-secrets-path global_provisioning/user.secrets --device-dir device1</code>. This will create a device for the &quot;United States&quot; and &quot;Japan&quot; regions and provision the device for &quot;drew&quot;, &quot;ben&quot;, and &quot;misha&quot;, allowing each of them to log in. Any output files will be put into a &quot;device&quot; directory.</li> <li>Run the device by running <code>./buildDevice -p /ectf/ -n test -bf all -secrets_dir device1/</code> (note that this takes a long time to run the first time you run it! Please be patient.) This will create a Vivado project called <code>test</code> and use the <code>device1</code> secrets directory.</li> <li>Run <code>./packageDevice ../boot-image/template.bif device1/miPod.bin /ectf/mb/Cora-Z7-07S/download.bit</code> to create a <code>miPod.BIN</code> file with your bitstream.</li> <li>Insert the SD card into the SD card reader, and insert that into your laptop.
Ensure that this is passed through to the VM through the VirtualBox USB options</li> <li>Run the <code>./deployDevice /dev/sdb ../BOOT.BIN global_provisioning/audio/ ../mb/miPod/Debug/miPod.elf ../boot-image/image.ub --mipod-bin-path device1/miPod.bin</code> script.</li> <li>Remove the SD card and place it into the board.</li> <li>Ensure that the jumper is connecting both pins of JP2 (this allows the device to boot from the SD card)</li> <li>Connect the Cora board to the computer. Ensure that the board (Digilent Adept USB Device) is passed through to the VM.</li> <li>See the <strong>Accessing UART From Inside the VM</strong> section of the <a href="/technical/vagrant/">Vagrant README</a> file to start minicom.</li> <li>Press the <code>RESET</code> button on the board to reset it. You should now see the board boot and enter a Linux shell.</li> <li><code>cd</code> to the <code>music</code> folder.</li> <li>Run the <code>./miPod.elf</code> application, and run <code>help</code> to see a list of all possible commands.</li></ol> <h2 id="working-with-the-xilinx-tools"><a href="#working-with-the-xilinx-tools" class="header-anchor">#</a> Working With the Xilinx Tools</h2> <p>You can launch <code>vivado</code> to modify the reference implementation programmable logic (PL).
<code>vivado</code> will also allow you to generate the bitstream and export the hardware to the SDK.
The SDK can be launched from Vivado, or directly from the command line to allow you to modify
the DRM project runing on the MicroBlaze and the miPod project running on the Linux side.</p> <h3 id="sdk-development-tips"><a href="#sdk-development-tips" class="header-anchor">#</a> SDK Development Tips</h3> <p>When first opening the SDK GUI, the project workspace should be set to the <code>mb/</code> directory. Import
all three projects (Cora-Z7-07S, drm_audio_fw, and drm_audio_fw_bsp) and then import the miPod
project. All four projects should appear in the Project Explorer to the left. If the initial build
fails, select <code>Project &gt; Clean...</code> to clean and rebuild the project.</p> <h4 id="manual-sdk-building"><a href="#manual-sdk-building" class="header-anchor">#</a> Manual SDK Building</h4> <p>While teams should regularly check that the full build and provision process works using the
provisioning tools, it may be faster to build and flash the device manually.</p> <p>To update the miPod:</p> <ol><li>Save all files to build the project. Ensure in the Console window that the build succeeded.</li> <li>Copy the file <code>miPod/Debug/miPod.elf</code> to <code>~/music/miPod</code> on the board (either over minicom or by USB drive)</li></ol> <p>To update the DRM:</p> <ol><li>Save all files to build the project. Ensure in the Console window that the build succeeded.</li> <li>Press the <code>Program FPGA</code> button on the upper bar or <code>Xilinx &gt; Program FPGA</code></li> <li>Ensure that the the ELF file to initialize in Block RAM for microblaze_0 is the drm_audio_fw.elf.
If it is anything else, click the box and then the drop down arrow that appars to the right.
The ELF file should appear. If it does not, ensure that the build succeeded.</li> <li>Choose Program. A dialog box saying &quot;Initializing Bitstream with ELF data&quot; should appear. If it
Disappears without an error message, the LED LD0 is red, and &quot;MB&gt; Audio DRM Module has Booted&quot;
is printed over UART, it successfully programmed.
<em>NOTE: Occasionally after multiple calls to Program FPGA, the FPGA does not actually program.
No error message prints, but the message over UART does not appear. If this happens, continue
to the next step</em></li> <li>Using the previous step, you should be able to reprogram the FPGA without rebooting the device.
However, these changes will not persist across power cycles. To accomplish this, insert the
micro SD card and select <code>Xilinx &gt; Create Boot Image</code> in the SDK. The output path should be set to
<code>&lt;SD boot partition&gt;/miPod.BIN</code>. If you have an existing BIF file, you can import from that.
Otherwise, the following partitions should be added (<strong>NOTE: THE ORDER MATTERS</strong>):
1. <code>boot-image/fsbl.elf</code> - a dummy bootloader that will never run. The real bootloader is
encrypted for your team in <code>boot-image/BOOT.BIN</code>, however the Xilinx tools require a bootloader.
2. <code>mb/Cora-Z7-07S/download.bit</code> - the bitstream loaded with the DRM ELF (created by step 4)</li> <li>Insert the SD card into the Cora board and the RESET button next to the power jack. When Linux finishes
booting, the MicroBlaze should have the updated bitstream.</li></ol></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">1/27/2020, 8:25:34 PM</span></div></footer> <!----> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.460b592d.js" defer></script><script src="/assets/js/2.cccabd22.js" defer></script><script src="/assets/js/11.c2b48b7a.js" defer></script>
  </body>
</html>
