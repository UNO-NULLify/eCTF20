(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{219:function(e,t,a){"use strict";a.r(t);var i=a(0),r=Object(i.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"security-implementation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#security-implementation"}},[e._v("#")]),e._v(" Security Implementation")]),e._v(" "),a("h2",{attrs:{id:"protection-of-flags"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#protection-of-flags"}},[e._v("#")]),e._v(" Protection of Flags")]),e._v(" "),a("h3",{attrs:{id:"region-lock"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#region-lock"}},[e._v("#")]),e._v(" Region Lock")]),e._v(" "),a("h4",{attrs:{id:"description"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#description"}},[e._v("#")]),e._v(" Description")]),e._v(" "),a("p",[e._v("Play a song from a region that the player is not provisioned for.")]),e._v(" "),a("h4",{attrs:{id:"requirement"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#requirement"}},[e._v("#")]),e._v(" Requirement")]),e._v(" "),a("p",[e._v("Confidentiality")]),e._v(" "),a("h4",{attrs:{id:"protection"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#protection"}},[e._v("#")]),e._v(" Protection")]),e._v(" "),a("p",[e._v("We verify the regions a song can be played in on every play to ensure it stays in it's provisioned regions.")]),e._v(" "),a("h3",{attrs:{id:"unauthorized-play"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#unauthorized-play"}},[e._v("#")]),e._v(" Unauthorized Play")]),e._v(" "),a("h4",{attrs:{id:"description-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#description-2"}},[e._v("#")]),e._v(" Description")]),e._v(" "),a("p",[e._v("Play a song that your user does not have access to.")]),e._v(" "),a("h4",{attrs:{id:"requirement-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#requirement-2"}},[e._v("#")]),e._v(" Requirement")]),e._v(" "),a("p",[e._v("Confidentiality/Authentication")]),e._v(" "),a("h4",{attrs:{id:"protection-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#protection-2"}},[e._v("#")]),e._v(" Protection")]),e._v(" "),a("p",[e._v("We check if the user is an owner or if they have had the song shared with them, and if the player is authorized to play that song based off of region provisioning information.")]),e._v(" "),a("p",[e._v("Additionally . . .")]),e._v(" "),a("h3",{attrs:{id:"pin-extraction"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pin-extraction"}},[e._v("#")]),e._v(" Pin Extraction")]),e._v(" "),a("h4",{attrs:{id:"description-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#description-3"}},[e._v("#")]),e._v(" Description")]),e._v(" "),a("p",[e._v("Obtain the pin for a user that you do not have access to.")]),e._v(" "),a("h4",{attrs:{id:"requirement-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#requirement-3"}},[e._v("#")]),e._v(" Requirement")]),e._v(" "),a("p",[e._v("Authentication")]),e._v(" "),a("h4",{attrs:{id:"protection-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#protection-3"}},[e._v("#")]),e._v(" Protection")]),e._v(" "),a("p",[e._v("We hash the pins using the cryptographically secure Argon2 algorithm.")]),e._v(" "),a("h3",{attrs:{id:"music-tamper"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#music-tamper"}},[e._v("#")]),e._v(" Music Tamper")]),e._v(" "),a("h4",{attrs:{id:"description-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#description-4"}},[e._v("#")]),e._v(" Description")]),e._v(" "),a("p",[e._v("Modify a protected song. Deliver a file of the modified, protected song.")]),e._v(" "),a("h4",{attrs:{id:"requirement-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#requirement-4"}},[e._v("#")]),e._v(" Requirement")]),e._v(" "),a("p",[e._v("Integrity")]),e._v(" "),a("h4",{attrs:{id:"protection-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#protection-4"}},[e._v("#")]),e._v(" Protection")]),e._v(" "),a("p",[e._v("We use a digital signature to verify the music has not been tampered with.")]),e._v(" "),a("h3",{attrs:{id:"custom-music"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#custom-music"}},[e._v("#")]),e._v(" Custom Music")]),e._v(" "),a("h4",{attrs:{id:"description-5"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#description-5"}},[e._v("#")]),e._v(" Description")]),e._v(" "),a("p",[e._v("Protect a provided custom song. Deliver a file of the custom, protected song.")]),e._v(" "),a("h4",{attrs:{id:"requirement-5"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#requirement-5"}},[e._v("#")]),e._v(" Requirement")]),e._v(" "),a("p",[e._v("Authentication/Confidentiality")]),e._v(" "),a("h4",{attrs:{id:"protection-5"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#protection-5"}},[e._v("#")]),e._v(" Protection")]),e._v(" "),a("p",[e._v("We use strong encryption to protect your song.")]),e._v(" "),a("h2",{attrs:{id:"compiler-changes"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#compiler-changes"}},[e._v("#")]),e._v(" Compiler Changes")]),e._v(" "),a("p",[a("strong",[e._v("Original Flags")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('mb-gcc -Wall -O0 -g3 -I"../../drm_audio_fw_bsp/microblaze_0/include" -c -fmessage-length=0 -MT"$@" -I"../../drm_audio_fw_bsp/microblaze_0/include" -mlittle-endian -mcpu=v10.0 -mxl-soft-mul -Wl,--no-relax -ffunction-sections -fdata-sections -MMD -MP -MF"$(@:%.o=%.d)" -MT"$(@)" -o "$@" "$<"\n')])])]),a("p",[a("code",[e._v("-Wall")]),e._v(" This flag is usefull in development.")]),e._v(" "),a("p",[a("code",[e._v("-Wextra")]),e._v(" Will be added to increase code quality.")]),e._v(" "),a("p",[a("code",[e._v("-Wconversion -Wsign-conversion")]),e._v(" added to warn about potential casting issues that may cause security vulnerabilities.")]),e._v(" "),a("p",[a("code",[e._v("-Os")]),e._v(" Added to optimize for code size.")]),e._v(" "),a("p",[a("code",[e._v("-s -fvisability=hidden")]),e._v(" To strip the symbols out of the binary.")]),e._v(" "),a("p",[a("code",[e._v("-static")]),e._v(" Tells the compiler to statically link all binaries, third party libraries cant be used to affect the functionality of our code")]),e._v(" "),a("p",[a("code",[e._v("-mxl-reorder")]),e._v(" To cause some chaos in reverse engeneering and exploit development by reordering instructions on run.")]),e._v(" "),a("p",[a("code",[e._v("-Wstack-protector --param ssp-buffer-size=4")]),e._v(" Adding stack protection to the elf.")]),e._v(" "),a("p",[a("code",[e._v("-Wl,-z,noexecstack")]),e._v(" Ensure the Stack is not executable.")]),e._v(" "),a("p",[a("code",[e._v("-mxl-barrel-shift -mno-xl-soft-div -mno-xl-soft-mul")]),e._v(" Combined with extra PL reduces code size and optimizes crypto operations.")]),e._v(" "),a("p",[a("code",[e._v("-DBLAKE2_NO_UNROLLING")]),e._v(" Reduces Blake2 crypto code size.")]),e._v(" "),a("p",[e._v("``")]),e._v(" "),a("p",[a("strong",[e._v("New Compiler Options")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('mb-gcc -Wall -Wextra -DBLAKE2_NO_UNROLLING -mxl-barrel-shift -mno-xl-soft-div -mno-xl-soft-mul -Os -fvisibility=hidden -static -Wconversion -Wsign-conversion -fstack-check -mxl-reorder -Wstack-protector --param ssp-buffer-size=4 -ftrapv -Wl,-z,relro,-z,now -Wl,-z,noexecstack -I"../../drm_audio_fw_bsp/microblaze_0/include" -I"../../drm_audio_fw/src/include" -I"/opt/Xilinx/SDK/2017.4/gnu/microblaze/linux_toolchain/lin32_le/microblazeel-xilinx-linux-gnu/sys-root/usr/include" -c -fmessage-length=0 -MT"$@" -mlittle-endian -mcpu=v10.0 -Wl,--relax -ffunction-sections -fdata-sections -MMD -MP -MF"$(@:%.o=%.d)" -MT"$(@)" -o "$@" "$<"\n')])])]),a("p",[a("strong",[e._v("New Linker Options")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('mb-gcc $(OBJS) $(USER_OBJS) $(LIBS) -L"../../drm_audio_fw_bsp/microblaze_0/lib" -Wl,-T -Wl,../src/lscript.ld -L"../../drm_audio_fw_bsp/microblaze_0/include" -Wall -Wextra -Wconversion -Wsign-conversion -mxl-barrel-shift -mno-xl-soft-div -mno-xl-soft-mul -s -fvisibility=hidden -static -mxl-reorder -fstack-check  -Wstack-protector --param ssp-buffer-size=4 -ftrapv -Wl,-z,noexecstack -mlittle-endian -mcpu=v10.0 -Wl,--relax -Wl,--gc-sections -o "drm_audio_fw.elf"\n')])])]),a("h2",{attrs:{id:"hardware-changes"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#hardware-changes"}},[e._v("#")]),e._v(" Hardware Changes")]),e._v(" "),a("p",[e._v("The overall layout of the programmable logic for this project will be left the same as the reference design.\nHowever, several key channels used to communicate between the main processor and the Microblaze will be\nchanged to make them more secure, the overall goals for these changes are as follows.")]),e._v(" "),a("ul",[a("li",[e._v("Reduce overall attack surface")]),e._v(" "),a("li",[e._v("Protect from informed hardware attacks")]),e._v(" "),a("li",[e._v("Reduce side channel vulnerabilities")])]),e._v(" "),a("p",[e._v("The first goal will be addressed by reducing the use of the shared DDR memory present in the reference\ndesign, since the main processor has full authority over it. The DDR memory should always be considered untrusted\nand unreliable. It is preferable that the DDR is interacted with as little as possible, and that only strongly encrypted\ndata be stored in it. Information should only be decrypted inside the programmable logic, where it is far safer.")]),e._v(" "),a("p",[e._v("The second goal will be the subject of a proposed hardware integrity monitoring module. Since our\nattackers have access to all the information used to create our programmable logic, including the Vivado project,\nthey will have copious information with which to devise hardware based attacks. Some of these attacks are\ndescribed in the hardware integrity module section bellow.")]),e._v(" "),a("p",[e._v("Side channel vulnerabilities, especially those that depend on fault injection, can be abated by minimizing\nthe coupling between the main processor and the Microblaze. We propose replacing the GPIO based interrupt\nscheme with a more specialized command register, thus abstracting the DRM system, be used to do this. This\ncommand register should be the primary means for issuing instructions to the Microblaze going forward. Side\nchannel resistant programming practices are also important for this goal, a primary task of the hardware team during\nthe both phases should be to locate such vulnerabilities.")]),e._v(" "),a("h3",{attrs:{id:"hardware-integrity-module"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#hardware-integrity-module"}},[e._v("#")]),e._v(" Hardware Integrity Module")]),e._v(" "),a("p",[e._v("A hardware component should be provided to protect the other trusted components from physical attacks.\nThis is especially important since attackers will have access to all resources necessary to implement the\nprogrammable logic, making such attacks highly informed and providing copious testing capabilities. The proposed\nmodule, hereafter referred to as the Basic Integrity Recording Device (BIRD), should provide protections from two\nbasic forms of tampering: clock glitch attacks and voltage glitch attacks.")]),e._v(" "),a("p",[e._v("Clock glitch attacks are spurious rising edges injected into a system with the purpose of violating setup\ntimes at specific points. One common use of clock glitching is to skip compare and branch instructions, which may\ncompromise the target system by skipping security checks or placing the machine in an illegal state.")]),e._v(" "),a("p",[e._v("Voltage glitch attacks are conducted by periodically shorting power to ground, creating a low voltage spike.\nThe goal of a voltage glitch attack is very similiar to a clock glitch attack, to cause a malfunction that then\ncompromises the system.")]),e._v(" "),a("p",[e._v("One characteristic of both types of fault attack are that in order to have useful behavior they usually need\nsomething to base their timing off of. Often this trigger is based on power analysis, which increases the value of anti\nside-channel measures.")]),e._v(" "),a("p",[e._v("Both types of glitch attacks, while difficult to prevent, can be detected using specialized glitch detection\ncircuits. These circuits are designed to be especially vulnerable to glitching, thus providing an early indication that a glitch has occurred. This indication can then by used to help secure the system, such as by issuing a reset. The\ndetection of glitch attacks can also be used to issue mockery to attackers via error messages. FPGA timing analysis\ntools can be used to construct such a detector circuit, and the operation of such a circuit can be verified in actual\nhardware by routing the clock input to a more easily accessible location.")]),e._v(" "),a("p",[e._v("Our target device contains two ADCs which can be configured in a window compare mode to monitor\ninternal voltages as well as die temperature. Each unit has a sampling rate of up to one megasample per second.\nUnfortunately this sampling rate may not be fast enough to detect voltage glitches, especially since each ADC's\nattention would have to be divided among several voltage rails. However, the ADCs can be used to prevent\noperation at excessively high or low voltages, which could otherwise be used to exacerbate the effects of\naforementioned attacks.")]),e._v(" "),a("p",[e._v("We propose that both the aforementioned integrity monitoring solutions be employed within our hardware\ndesign, as well as any fault detection features whose utility becomes apparent during software design.")]),e._v(" "),a("h3",{attrs:{id:"command-register"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#command-register"}},[e._v("#")]),e._v(" Command Register")]),e._v(" "),a("p",[e._v("In contrast to the provided reference design, which sends commands via a shared area in DDR, we propose\na register based method of issuing commands to the embedded processor. Accessing this command register can be\ndone almost identically to configuring a peripheral on a microcontroller. Using this scheme has two primary\nadvantages over sharing memory.")]),e._v(" "),a("p",[e._v("Firstly, we will have full physical control over the behavior of the register. For example, if we detect that\nthe Microblaze has been compromised, we can lock the command register so that information cannot be smuggled\nout of the PL.")]),e._v(" "),a("p",[e._v("Secondly, we can send interrupts to the embedded processor automatically when the register is written to.\nThis makes the issuing of commands slightly more deterministic compared to the reference, but hides the\nacknowledgement by the Microblaze from the processor. This scheme may help reduce side channel vulnerability of\nthe embedded processor by reducing the attack surface for fault injection. In the reference design, such a fault\ninjection might consist of modifying values in the command channel struct while they are in use by the Microblaze.")]),e._v(" "),a("p",[e._v("One should note that the command register need not be a simple register. Each bit or group of bits can be\nindividually read or write protected, indicate status, trigger an interrupt, or perform another special function. For\nexample, bits may feed into a shift register or block ram. This would allow for longer commands to be shifted into a\nsafe area which only the Microblaze may access, again reducing the surface for fault injection attacks.")]),e._v(" "),a("p",[e._v("An example implementation of the command register could be structured as follows, an 8 bit alignment was\nchosen to ensure that writes are made with a single instruction, and to allow use of the write strobe feature of the\nAXI bus.")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("MSB                                                              LSB\n[   COMMAND   (W)][   DATA IN   (W)][   STATUS   (R)][   RESP   (R)]\nW: write only, reads will return zero \nR: read only, writes will have no effect\n")])])]),a("p",[e._v("The command field in this instance should allow the main processor to signal any of the commands as implemented in the reference design. These are:")]),e._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}}),e._v(" "),a("th",{staticStyle:{"text-align":"center"}})])]),e._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[e._v("load_file")]),e._v(" "),a("td",{staticStyle:{"text-align":"center"}},[e._v("query_song")])]),e._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[e._v("login")]),e._v(" "),a("td",{staticStyle:{"text-align":"center"}},[e._v("share_song")])]),e._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[e._v("logout")]),e._v(" "),a("td",{staticStyle:{"text-align":"center"}},[e._v("play_song")])]),e._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[e._v("query_player")]),e._v(" "),a("td",{staticStyle:{"text-align":"center"}},[e._v("digital_out")])])])]),e._v(" "),a("p",[e._v("The command register and DMA should be locked whenever a fault is detected, and only unlocked after the proper booting of the Microblaze. Additionally any areas which may contain secrets should be erased, such as the microblaze RAM and ROM, and the secrets container, if one is used. This functionality should be controlled by the basic integrity recording device (BIRD) discussed above.")]),e._v(" "),a("p",[e._v("To avoid potential fault injection, the command register should not generate interrupts when they are not anticipated. In a scheme where the main processor polls the DRM, status flags, which may be presented in the status field in this example, should be the only method of stalling the main processor when the Microblaze is busy.")]),e._v(" "),a("h2",{attrs:{id:"data-flow"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#data-flow"}},[e._v("#")]),e._v(" Data Flow")]),e._v(" "),a("p",[a("img",{attrs:{src:"/data-flow.png",alt:"Data Flow"}})]),e._v(" "),a("p",[e._v("Several changes have been made to the MITRE reference design programmable logic to facilitate the implementation of an encryption scheme carried out by the microblaze. In the reference design, an AXI Direct Memory Access (DMA) module was used to transfer chunks of song to an FIFO. This fifo crosses from the main clock domain to the codec clock domain, and the I2S codec can pull samples from the FIFO at the designed sample rate, independent of the frequency of the main clock or the timing with which this FIFO is filled.")]),e._v(" "),a("p",[e._v("Our design introduces a new FIFO, hereafter termed the input FIFO, which becomes the new destination for the DMA. The output of this module connects directly to the microblaze via an AXI Streaming interface, a dedicated instruction in the microblaze allows a 32 bit read or write from this type of interface. Another streaming interface is used to write data to the original FIFO, now referred to as the output FIFO, which is connected to the codec. Our software need only treat these devices like pipes. Additionally, a GPIO module is provided to read the fill level of either FIFO.")]),e._v(" "),a("p",[e._v("The output FIFO's width has been changed to simplify connectivity, which requires samples to be written twice but enables future implementation of stereo audio capability with changes to software only. Also, the clock generation for the codec's clock domain can now be reconfigured by the microblaze, which would enable playback of audio with different sample rates with changes to software only.")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("\tMSB                                                              LSB\n[   UNUSED    (W)][   COMMAND   (W)][           STATUS          (R)]\nW: write only, reads will return zero \nR: read only, writes will have no effect\n")])])]),a("p",[e._v("Commands from the miPod application are now issued through a shared register which generates an interrupt on the microblaze when written. The application side of the register cannot modify any commands it has already issued, and a new interrupt shall not be dispatched until it is acknowledged by a special write issued by the microblaze. This command register is also the means by which a hardware watchdog timer is reset.")]),e._v(" "),a("h2",{attrs:{id:"watchdog"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#watchdog"}},[e._v("#")]),e._v(" Watchdog")]),e._v(" "),a("p",[e._v("The integrity-checking module served to protect against voltage and temperature attacks, but it in no way ensures that the DRM is properly operating in a timely manner. The watchdog timerâ€™s purpose is thus to make sure that the DRM is still responsive within a short window of time. This prevents several attacks which slow or halt the MicroBlaze.\nXilinx provides an AXI Timebase Watchdog module, which uses a dual-expiration architecture. This generates an interrupt and a state bit is changed in the status register. If the MicroBlaze fails to clear the state bit before the next timeout, the WDT generates a reset signal. Thus, if the DRM halts or lags beyond a reasonable time threshold, the PL will assume an attack is occurring and reset the MicroBlaze. This solution maps the watchdog timer registers into the address space of the MB and creates an AXI connection between the WDT and the interrupt controller. The DRM code then handles the interrupt by clearing the status bits in the WDT status register.")]),e._v(" "),a("h2",{attrs:{id:"integrity-monitor"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#integrity-monitor"}},[e._v("#")]),e._v(" Integrity Monitor")]),e._v(" "),a("p",[a("img",{attrs:{src:"/integrity-mod.png",alt:"Integrity Module Implementation"}})]),e._v(" "),a("p",[e._v("While less common, it is possible to retrieve or corrupt information by temperature attacks. Extreme cold temperatures can be used to halt a processor during operation, while extreme heat can result in errors and incorrect memory loading. Similarly, it has been demonstrated that tampering with voltages can cause errors to occur while a computer is processing secret information, resulting in a leak of secrets.\nTo protect against these attacks, the FPGA has a built in ADC (XADC) that monitors temperature and voltage sensors. The module contains status registers which can be read either via JTAG or programmable logic. 7 alarm registers are also included as output signals which are active-HIGH. The alarms given, along with their respective status registers are shown in the figure below. Since the XADC also connects to the processing system via AXI, it is also possible to read the status registers from the processing system; however, it is better practice to read the status using the programmable logic. The solution arrived at was to combine the signals into an active-LOW reset signal using a 7-input NOR module whose output is tied to the proc_sys_reset module.")]),e._v(" "),a("p",[a("img",{attrs:{src:"/alarm-reg.png",alt:"Alarm Registers"}})])])}),[],!1,null,null,null);t.default=r.exports}}]);