<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Sharing | eCTF Documentation</title>
    <meta name="description" content="NULLify">
    
    
    <link rel="preload" href="/assets/css/0.styles.78f28ec0.css" as="style"><link rel="preload" href="/assets/js/app.1a38b3e9.js" as="script"><link rel="preload" href="/assets/js/2.d81d59a6.js" as="script"><link rel="preload" href="/assets/js/23.7e7c4a24.js" as="script"><link rel="prefetch" href="/assets/js/10.007dda0f.js"><link rel="prefetch" href="/assets/js/11.13cf8a39.js"><link rel="prefetch" href="/assets/js/12.914841a3.js"><link rel="prefetch" href="/assets/js/13.fa5546fe.js"><link rel="prefetch" href="/assets/js/14.aa7165da.js"><link rel="prefetch" href="/assets/js/15.e18563b9.js"><link rel="prefetch" href="/assets/js/16.000a4300.js"><link rel="prefetch" href="/assets/js/17.de36a721.js"><link rel="prefetch" href="/assets/js/18.2dc52e2d.js"><link rel="prefetch" href="/assets/js/19.8a7d5380.js"><link rel="prefetch" href="/assets/js/20.f3895d39.js"><link rel="prefetch" href="/assets/js/21.48e417ca.js"><link rel="prefetch" href="/assets/js/22.949c40a6.js"><link rel="prefetch" href="/assets/js/24.2d48901e.js"><link rel="prefetch" href="/assets/js/25.ceaddddd.js"><link rel="prefetch" href="/assets/js/3.d4afdc96.js"><link rel="prefetch" href="/assets/js/4.90489dad.js"><link rel="prefetch" href="/assets/js/5.037880d8.js"><link rel="prefetch" href="/assets/js/6.071b6179.js"><link rel="prefetch" href="/assets/js/7.f0459ecd.js"><link rel="prefetch" href="/assets/js/8.f6099ec2.js"><link rel="prefetch" href="/assets/js/9.48e6ce21.js">
    <link rel="stylesheet" href="/assets/css/0.styles.78f28ec0.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/nullify_lock_no_padding.png" alt="eCTF Documentation" class="logo"> <span class="site-name can-hide">eCTF Documentation</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/mitre/" class="nav-link">Official Documentation</a></div><div class="nav-item"><a href="/technical-reference/" class="nav-link router-link-active">Technical Reference</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/mitre/" class="nav-link">Official Documentation</a></div><div class="nav-item"><a href="/technical-reference/" class="nav-link router-link-active">Technical Reference</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/" class="sidebar-link">Home</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/mitre/" class="sidebar-heading clickable"><span>Official Documentation</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/technical-reference/" class="sidebar-heading clickable router-link-active open"><span>Technical Reference</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/technical-reference/authentication.html" class="sidebar-link">Authentication</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/technical-reference/authentication.html#login" class="sidebar-link">Login</a></li><li class="sidebar-sub-header"><a href="/technical-reference/authentication.html#logout" class="sidebar-link">Logout</a></li></ul></li><li><a href="/technical-reference/querying.html" class="sidebar-link">Querying</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/technical-reference/querying.html#query-song" class="sidebar-link">Query Song</a></li><li class="sidebar-sub-header"><a href="/technical-reference/querying.html#query-player" class="sidebar-link">Query Player</a></li></ul></li><li><a href="/technical-reference/encryption.html" class="sidebar-link">Encryption</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/technical-reference/encryption.html#overview" class="sidebar-link">Overview</a></li><li class="sidebar-sub-header"><a href="/technical-reference/encryption.html#protect-song" class="sidebar-link">Protect Song</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/technical-reference/encryption.html#encrypt-song" class="sidebar-link">Encrypt Song</a></li></ul></li><li class="sidebar-sub-header"><a href="/technical-reference/encryption.html#generating-secrets" class="sidebar-link">Generating Secrets</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/technical-reference/encryption.html#generating-full-secret" class="sidebar-link">Generating Full Secret</a></li><li class="sidebar-sub-header"><a href="/technical-reference/encryption.html#generating-30-second-secret" class="sidebar-link">Generating 30 Second Secret</a></li></ul></li></ul></li><li><a href="/technical-reference/sharing.html" class="active sidebar-link">Sharing</a></li><li><a href="/technical-reference/playing.html" class="sidebar-link">Playing</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/technical-reference/playing.html#playing-full-song" class="sidebar-link">Playing Full Song</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/technical-reference/playing.html#decrypting-a-full-song" class="sidebar-link">Decrypting a full song</a></li></ul></li><li class="sidebar-sub-header"><a href="/technical-reference/playing.html#playing-a-shared-song" class="sidebar-link">Playing a Shared Song</a></li><li class="sidebar-sub-header"><a href="/technical-reference/playing.html#playing-30-second-sample" class="sidebar-link">Playing 30 Second Sample</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/technical-reference/playing.html#decrypting-30-second-sample" class="sidebar-link">Decrypting 30 second sample</a></li></ul></li></ul></li><li><a href="/technical-reference/metadata.html" class="sidebar-link">Song Metadata</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="sharing"><a href="#sharing" class="header-anchor">#</a> Sharing</h1> <p>To share a song, there are four arguments that are needed:</p> <ul><li><code>uint8_t uid</code> - The ID of the song owner (current user).</li> <li><code>uint8_t sid</code> - The ID of the user the song is being shared with.</li> <li><code>char *pin</code> - The current users pin. This is used to generate the secret.</li> <li><code>struct metadata *metadata</code> - A pointer to the song <a href="/technical-reference/metadata.html">metadata structure</a>.</li></ul> <div class="language-c extra-class"><pre class="language-text"><code>int shareSong(uint8_t uid, uint8_t sid, char * pin, struct metadata * meta) {}
</code></pre></div><p>Sharing works by encrypting the song key, the key that decrypts the song, with the person receiving the songs public key. The first step to doing this is to hash the users pin passed through to the function with monocypher's BLAKE2b:</p> <div class="language-c extra-class"><pre class="language-text"><code>crypto_blake2b(hashed_pin, pin, strlen(pin)); 
</code></pre></div><p>This is then used to unlock the private key as follows:</p> <div class="language-c extra-class"><pre class="language-text"><code>crypto_unlock(pvt_key, hashed_pin, nonce, mac, enc_pvt_key, 32)
</code></pre></div><p>Your private key is then used in combination with the song owners public key to decrypt the song. This is using monocypher's <a href="https://monocypher.org/manual/key_exchange" target="_blank" rel="noopener noreferrer">Crypto key Exchange<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <div class="language-c extra-class"><pre class="language-text"><code>crypto_key_exchange(shared_key, pvt_key, pub_key);
</code></pre></div><p>After the sharedInfo is generated, we write it to the metadata for the shared user to access.</p> <p>The next step is to generate the secret for the song and hash it with BLAKE2b. Generating secrets is explained in greater detail in the <a href="/technical-reference/encryption.html#generating-secrets">Secret Generation documentation</a>.</p> <div class="language-c extra-class"><pre class="language-text"><code>secretFull = generateSecret(pin, meta);
crypto_blake2b(hash, secretFull, 160); 
</code></pre></div><p>Finally, all of this information is used to call monocypher's <code>crypto_lock</code> function:</p> <div class="language-c extra-class"><pre class="language-text"><code>crypto_lock(meta-&gt;sharedInfo[sid-1] + 32, meta-&gt;sharedInfo[sid-1] , shared_key, nonceEnc, hash, 32 );
</code></pre></div><p>To play a song shared with you, you need to first decrypt your private key with your pin and pinhash. Then, decrypt the encrypted song key with your private key and play the song. This is covered in greater detail in the <a href="/technical-reference/playing.html">Play Song documentation</a>.</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">4/24/2020, 9:26:42 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/technical-reference/encryption.html" class="prev">Encryption</a></span> <span class="next"><a href="/technical-reference/playing.html">Playing</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.1a38b3e9.js" defer></script><script src="/assets/js/2.d81d59a6.js" defer></script><script src="/assets/js/23.7e7c4a24.js" defer></script>
  </body>
</html>
